angular.module("MassAutoComplete",[]).directive("massAutocomplete",["$timeout","$window","$document","$q",function(n,t,i,r){"use strict";return{restrict:"A",scope:{options:"&massAutocomplete"},transclude:!0,template:'<span ng-transclude><\/span><div class="background" type="text" ng-bind="selection" /><div class="ac-container" ng-show="show_autocomplete && results.length > 0" style="position:absolute;"><ul class="ac-menu"><li ng-repeat="result in results" ng-if="$index > 0" class="ac-menu-item" ng-class="$index == selected_index ? \'ac-state-focus\': \'\'"><a href ng-click="apply_selection($index)" ng-bind-html="result.label"><\/a><\/li><\/ul><\/div>',link:function(n,t){n.container=angular.element(t[0].getElementsByClassName("ac-container")[0])},controller:["$scope",function(u){function b(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;i||n.apply(u,f)},o=i&&!r;clearTimeout(r);r=setTimeout(e,t);o&&n.apply(u,f)}}function it(n,t){return v||(v=$("<span>").hide().appendTo(document.body)),v.text(n).css("font",t),v.width()}function d(){var n=angular.element(f[0]),i=n.position(),o=n.height(),r=angular.element(u.container[0]);r.css("top",i.top+o);var s=i.left,e=0,t=n.val();t.includes(".")&&(e=it(t.substring(0,t.lastIndexOf(".")),n.css("font")));r.css("left",s+e)}function rt(n,t,r){f!==t&&(f&&h.detach(),t[0]===i[0].activeElement)&&(r.on_attach&&r.on_attach(),f=t,c=n,e=r,p=n.$viewValue,u.results=[],u.selected_index=-1,ft(),w=u.$watch(function(){return n.$modelValue},function(n){n!==k&&(d(),nt(n,f))}))}function ut(n,t){u.selected_index=0;u.waiting_for_suggestion=!0;typeof n=="string"&&n.length>0?r.when(e.suggest(n),function(i){f&&f===t&&(i&&i.length>0?(u.results=[{value:n,label:""}].concat(i),u.selection=i.length>0?i[0].value:"",u.show_autocomplete=!0,e.auto_select_first&&y(1)):u.results=[])},function(n){u.show_autocomplete=!1;e.on_error&&e.on_error(n)}).finally(function(){u.waiting_for_suggestion=!1;u.results.length===0&&(u.selection="")}):(u.waiting_for_suggestion=!1,u.show_autocomplete=!1,u.selection="",u.$apply())}function tt(n){c.$modelValue!==n&&(c.$setViewValue(n),c.$render())}function y(n){var t=u.results[n];return f.val(t.value),u.selected_index=n,n>0&&(u.selection=t.value,f[0].selectionStart=u.results[0].value.length,f[0].selectionEnd=t.value.length),t}function ft(){angular.element(t).bind(s.RESIZE,g);f.bind(s.BLUR,function(){n(function(){f&&f[0]===i[0].activeElement||h.detach()},a.debounce_blur)});f.bind(s.KEYDOWN,function(n){if(!n.shiftKey)switch(n.keyCode){case o.ESC:u.show_autocomplete?(u.show_autocomplete=!1,u.$apply()):f.val(p);break;case o.ENTER:u.show_autocomplete&&u.selected_index>0&&!u.waiting_for_suggestion&&(u.apply_selection(u.selected_index),n.stopPropagation(),n.preventDefault());u.show_autocomplete=!1;u.$apply();break;case o.TAB:if(!u.show_autocomplete)break;n.preventDefault();case o.DOWN:u.results.length>0&&(u.show_autocomplete?(n.preventDefault(),y(u.selected_index+1>u.results.length-1?0:u.selected_index+1)):(u.show_autocomplete=!0,u.selected_index=0),u.$apply());break;case o.UP:u.show_autocomplete&&(n.preventDefault(),y(u.selected_index-1>=0?u.selected_index-1:u.results.length-1),u.$apply());break;case o.RIGHT:u.show_autocomplete&&(u.selected_index<=0&&(u.selected_index=1),u.waiting_for_suggestion||(u.apply_selection(u.selected_index),n.stopPropagation(),n.preventDefault(),u.show_autocomplete=!1),u.$apply())}})}var h=this,o={TAB:9,ESC:27,ENTER:13,UP:38,RIGHT:39,DOWN:40},s={KEYDOWN:"keydown",RESIZE:"resize",BLUR:"blur"},l=u.options()||{},a={debounce_position:l.debounce_position||150,debounce_attach:l.debounce_attach||300,debounce_suggest:l.debounce_suggest||200,debounce_blur:l.debounce_blur||150},f,c,e,p,w,k,v,g,nt;u.selection="";u.show_autocomplete=!1;g=b(d,a.debounce_position);h.attach=b(rt,a.debounce_attach);nt=b(ut,a.debounce_suggest);h.detach=function(){if(f){var n=f.val();tt(n);e.on_detach&&e.on_detach(n);f.unbind(s.KEYDOWN);f.unbind(s.BLUR)}u.show_autocomplete=!1;angular.element(t).unbind(s.RESIZE);w&&w();u.selected_index=u.results=undefined;c=f=p=undefined};u.apply_selection=function(n){if(f[0].focus(),u.show_autocomplete&&!(n>u.results.length)&&!(n<0)){var t=y(n);k=t.value;tt(t.value);u.show_autocomplete=!1;u.selection="";e.on_select&&e.on_select(t)}};u.$on("$destroy",function(){h.detach();u.container.remove()})}]}}]).directive("massAutocompleteItem",function(){"use strict";return{restrict:"A",require:["^massAutocomplete","ngModel"],scope:{massAutocompleteItem:"&"},link:function(n,t,i,r){i.$set("autocomplete","off");t.bind("focus",function(){var i=n.massAutocompleteItem();if(!i)throw"Invalid options";r[0].attach(r[1],t,i)})}}});
//# sourceMappingURL=massautocomplete.min.js.map
